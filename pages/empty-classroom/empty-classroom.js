import plugin from'../../component/v2/plugins/index'import selectable from'../../component/v2/plugins/selectable'import solarLunar from'../../component/v2/plugins/solarLunar/index'plugin.use(solarLunar).use(selectable)var t=(require("../../libraries/util.js"),getApp());const now=new Date()Page({data:{node_arr:[false,false,false,false,false],tech_arr:[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false],tech_arr_1:[false,false,false,false],tech_arr_2:[false,false,false,false],tech_arr_3:[false,false,false,false],tech_arr_4:[false,false,false,false],TechCount:0,chooseTech:false,notifucationText:"教务系统正常访问,目前该页面正常使用,数据准确",teachingBuild_1:[{"teachingBuildingName":"教十一楼","teachingBuildingId":"001",},{"teachingBuildingName":"教九楼B座","teachingBuildingId":"002",},{"teachingBuildingName":"教十楼B座","teachingBuildingId":"003",},{"teachingBuildingName":"教七楼","teachingBuildingId":"004",}],teachingBuild_2:[{"teachingBuildingName":"教八楼","teachingBuildingId":"005",},{"teachingBuildingName":"实验综合楼","teachingBuildingId":"006",},{"teachingBuildingName":"教六楼","teachingBuildingId":"007",},{"teachingBuildingName":"教八楼B座","teachingBuildingId":"008",}],teachingBuild_3:[{"teachingBuildingName":"教十楼A座","teachingBuildingId":"009",},{"teachingBuildingName":"教九楼A座","teachingBuildingId":"010",},{"teachingBuildingName":"二校田径场","teachingBuildingId":"011",},{"teachingBuildingName":"二校北体育场","teachingBuildingId":"012",}],teachingBuild_4:[{"teachingBuildingName":"体育中心","teachingBuildingId":"013",},{"teachingBuildingName":"文体中心","teachingBuildingId":"014",},{"teachingBuildingName":"二校东篮球场","teachingBuildingId":"015",},{"teachingBuildingName":"虚拟考试楼","teachingBuildingId":"016",}],indexCamp:0,node_info:[{"nodeName":"第一大节","nodeId":"1"},{"nodeName":"第二大节","nodeId":"2"},{"nodeName":"第三大节","nodeId":"3"},{"nodeName":"第四大节","nodeId":"4"},{"nodeName":"第五大节","nodeId":"5"}],isToday:true,selectDayStr:new Date().getFullYear()+"年"+(new Date().getMonth()+1)+"月"+new Date().getDate()+"日",show_check:false,show_check_tech:false,indexNodeCustom:"",customName:"",show_calendar:false,selected_days:[{year:new Date().getFullYear(),month:new Date().getMonth()+1,date:new Date().getDate(),}],node_check:[{value:'01,02',name:'第一大节'},{value:'03,04',name:'第二大节'},{value:'05,06',name:'第三大节'},{value:'07,08',name:'第四大节'},{value:'09,10',name:'第五大节'}],fastParams:[{"nodeName":"上午","nodeId":"M"},{"nodeName":"下午","nodeId":"A"},{"nodeName":"晚上","nodeId":"E"},{"nodeName":"全天","nodeId":"ALL"}],calendarConfig:{multi:true,theme:'default',showLunar:true,inverse:true,markToday:'今',emphasisWeek:true,highlightToday:true,preventSwipe:true,firstDayOfWeek:'Mon',onlyShowCurrentMonth:true,}},onLoad:function(a){var b=this wx.request({url:'https://dong12138.online/cur/getMain1.php',method:'GET',success(e){b.setData({notifucationText:e.data})}})this.findTeachingBuilding()this.findFreeNodeParams()},onShow:function(){},afterCalendarRender(){this.setData({show_check:false,show_check_tech:false})const calendar=this.selectComponent('#calendar')var now=new Date()var t_s=now.getTime();var former=new Date()former.setTime(t_s-1000*60*60*24*30)var later=new Date()later.setTime(t_s+1000*60*60*24*30)var former_str=former.getFullYear()+"-"+(former.getMonth()+1)+"-"+former.getDate()var later_str=later.getFullYear()+"-"+(later.getMonth()+1)+"-"+later.getDate()calendar.calendar.enableArea([former_str,later_str])calendar.calendar.setSelectedDates(this.data.selected_days)},afterTapDate:function(e){var a=new Date(now.getFullYear()+"/"+(now.getMonth()+1)+"/"+now.getDate())const calendar=this.selectComponent('#calendar')var b=calendar.calendar.getSelectedDates()this.setData({selected_days:b})if(calendar.calendar.getSelectedDates().length==1){var c=new Date(b[0].year+"/"+b[0].month+"/"+b[0].date)if(parseInt((c-a)/(1000*60*60*24))==0){this.setData({selectDayStr:a.getFullYear()+"年"+(a.getMonth()+1)+"月"+a.getDate()+"日",isToday:true})}else{this.setData({selectDayStr:c.getFullYear()+"年"+(c.getMonth()+1)+"月"+c.getDate()+"日",isToday:false})}}else if(calendar.calendar.getSelectedDates().length==0){this.setData({selectDayStr:"请选择一个日期",isToday:false})}else{this.setData({selectDayStr:"选择了多个日期",isToday:false})}},showLoading:function(){wx.showNavigationBarLoading(),this.setData({subtitle:"加载中...",loading:!0})},hideLoading:function(){wx.hideNavigationBarLoading(),wx.stopPullDownRefresh(),this.setData({loading:!1,submiting:!1})},hideMask:function(){var a=this.data.showMask;this.setData({showMask:!a})},show_check:function(a){this.setData({show_check:!this.data.show_check,show_check_tech:false,show_calendar:false})},show_check_tech:function(a){this.setData({show_check:false,show_check_tech:!this.data.show_check_tech,show_calendar:false,tech_arr:this.data.tech_arr,tech_arr_1:this.data.tech_arr_1,tech_arr_2:this.data.tech_arr_2,tech_arr_3:this.data.tech_arr_3,tech_arr_4:this.data.tech_arr_4})},findTeachingBuilding:function(){var i=this;var a=t.globalData.buildingInfo var e=[];for(var n=0;n<a.length;n++){e.push(a[n]['teachingBuildingName'])}i.setData({teachingBuild:a,teachingBuildStr:e})},findFreeNodeParams:function(){var e=[]for(var n=0;n<this.data.node_info.length;n++){e.push(this.data.node_info[n].nodeName)}this.setData({nodeParams:e})},tabSubmit:function(){var b=this.data.selected_days var c=this.data.tech_arr var d=new Date(now.getFullYear()+"/"+(now.getMonth()+1)+"/"+now.getDate())var a=""if(b.length==0){wx.showToast({title:"请选择日期",icon:"none"});return}else if(b.length==1){a+=("&selectDayStr="+this.data.selectDayStr)}else{a+="&selectDayStr=选择了多个日期"}a+="&date="for(let i=0;i<b.length;i++){var e=new Date(b[i].year+"/"+b[i].month+"/"+b[i].date)a+=((parseInt((e-d)/(1000*60*60*24))))+","}a=a.substr(0,a.length-1)a+="&teachBuildingStr="if(!this.data.chooseTech){a+="所有教学楼&building="}else if(this.data.chooseTech&&this.data.TechCount==1){a+=(this.data.teachingBuildStr[this.data.indexTeach]+"&building="+this.data.teachingBuild[this.data.indexTeach].teachingBuildingId)}else{a+="选中了多个教学楼&building="for(let i=0;i<c.length;i++){if(c[i]){a+=(this.data.teachingBuild[i].teachingBuildingId+',')}}a=a.substr(0,a.length-1)}a+="&nodeName="if(!this.data.indexNodeCustom){a+="全天"}else{a+=this.data.customName}a+=("&node="+this.data.indexNodeCustom)wx.navigateTo({url:"../classroom-list/classroom-list?"+a})},tabFirstSelect:function(a){var t=a.currentTarget.dataset.name,i=a.currentTarget.dataset.id;switch(i){case'M':{var b="1,2"break}case'A':{var b="3,4"break}case'E':{var b='5'break}case'ALL':{var b=''break}}wx.navigateTo({url:"../classroom-list/classroom-list?&selectDayStr="+new Date().getFullYear()+"年"+(new Date().getMonth()+1)+"月"+new Date().getDate()+"日"+"&date=0&teachBuildingStr=所有教学楼&building=&nodeName="+t+"&node="+b})},tapNodeCustomDelete:function(){var d=[false,false,false,false,false]this.setData({indexNodeCustom:"",customName:"",node_arr:d})},tap_check:function(e){var a=""var b=""var c=this.data.node_arr c[e.currentTarget.id]=!c[e.currentTarget.id]for(var i=0;i<5;i++){if(c[i]){if(a!=""){a+=","cur_text+="、"}a+=this.data.node_info[i].nodeId b+=this.data.node_info[i].nodeName}}this.setData({node_arr:c,indexNodeCustom:a,customName:b})},tap_check_1:function(e){var a=parseInt(e.currentTarget.dataset.status)var b=this.data.tech_arr switch(a){case 0:{var c=this.data.tech_arr_1 break}case 4:{var c=this.data.tech_arr_2 break}case 8:{var c=this.data.tech_arr_3 break}case 12:{var c=this.data.tech_arr_4 break}}var d=parseInt(e.currentTarget.id)if(!this.data.chooseTech){c[d]=true b[d+a]=true this.setData({chooseTech:true,TechCount:1,indexTeach:d+a})}else if(this.data.TechCount==1&&(d+a)==this.data.indexTeach){c[d]=false b[d+a]=false this.setData({chooseTech:false,TechCount:0})}else if(this.data.TechCount==1){c[d]=true b[d+a]=true this.setData({chooseTech:true,TechCount:2})}else if(this.data.TechCount==2&&b[a+d]){c[d]=false b[d+a]=false for(let i=0;i<b.length;i++)if(b[i]){var f=i;break}this.setData({chooseTech:true,TechCount:1,indexTeach:f})}else{var g=b[d+a]?-1:1;c[d]=!c[d]b[d+a]=!b[d+a]this.setData({TechCount:this.data.TechCount+g})}this.setData({tech_arr:b})switch(a){case 0:{this.setData({tech_arr_1:c})break}case 5:{this.setData({tech_arr_2:c})break}case 9:{this.setData({tech_arr_3:c})break}case 13:{this.setData({tech_arr_4:c})break}}},tap_clear_teach:function(e){var a=[false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false,false]var b=[false,false,false,false,false]var c=[false,false,false,false]var d=[false,false,false,false]var f=[false,false,false,false]this.setData({tech_arr:a,tech_arr_1:b,tech_arr_2:c,tech_arr_3:d,tech_arr_4:f,chooseTech:false,TechCount:0})},callDatepicker:function(e){this.setData({show_calendar:!this.data.show_calendar})}});